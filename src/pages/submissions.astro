---
import Layout from '../layouts/Layout.astro';
import Icon from '../components/Icon.astro';
import CrossIcon from '../components/CrossIcon.astro';

const jamStart = new Date('2026-02-07T18:00:00-06:00');
const jamEnd = new Date('2026-02-14T18:00:00-06:00');
---

<Layout title="Submit Your Game | Catholic Game Jam">
  <main class="submissions-page">
    <!-- Header -->
    <section class="submissions-hero">
      <div class="container">
        <a href="/" class="back-link">‚Üê Back to Home</a>
        <h1>Submit Your Game</h1>
        <p class="tagline">You made it! Upload your creation and share it with the world.</p>
      </div>
    </section>

    <!-- Status Banner -->
    <section class="status-section">
      <div class="container">
        <div id="status-banner" class="status-banner">
          <span class="status-icon">‚è≥</span>
          <span class="status-text">Checking submission window...</span>
        </div>
      </div>
    </section>

    <!-- Submission Form -->
    <section class="section" id="submit">
      <div class="container">
        <div id="submission-form-container" class="form-container">
          <div class="lock-overlay" id="lock-overlay">
            <div class="lock-icon"><Icon name="lock" size={48} /></div>
            <h2>Submissions Not Yet Open</h2>
            <p>The submission portal opens when the jam starts.</p>
            <div class="countdown-mini" id="countdown-mini"></div>
          </div>

          <div class="submission-form">
            <h2>Game Details</h2>

            <form id="submission-form" action="https://formsubmit.co/johnvondrashek+catholicgamejam@gmail.com" method="POST">
              <!-- Formsubmit config -->
              <input type="hidden" name="_subject" value="New Game Submission!" />
              <input type="hidden" name="_captcha" value="false" />
              <input type="hidden" name="_template" value="table" />
              <div class="form-group">
                <label for="game-title">Game Title *</label>
                <input type="text" id="game-title" name="game-title" required placeholder="Enter your game's title" />
              </div>

              <div class="form-group">
                <label for="team-name">Team/Developer Name *</label>
                <input type="text" id="team-name" name="team-name" required placeholder="Your name or team name" />
              </div>

              <div class="form-group">
                <label for="github-repo">GitHub Repository *</label>
                <input type="url" id="github-repo" name="github-repo" required placeholder="https://github.com/username/your-game" pattern="https://github\.com/.+/.+" />
                <span class="field-hint" id="github-hint">Must be a GitHub URL (https://github.com/username/repo)</span>
                <span class="field-error" id="github-error"></span>
              </div>

              <div class="form-group">
                <label for="showcase-link">Showcase Page (optional)</label>
                <input type="url" id="showcase-link" name="showcase-link" placeholder="https://your-game.itch.io or custom page" />
              </div>

              <div class="form-group">
                <label for="description">Short Description *</label>
                <textarea id="description" name="description" rows="3" required placeholder="Describe your game in 2-3 sentences"></textarea>
              </div>

              <div class="form-group">
                <label for="catholic-element">Catholic Element *</label>
                <textarea id="catholic-element" name="catholic-element" rows="2" required placeholder="How does your game incorporate Catholic themes, values, or imagery?"></textarea>
              </div>

              <div class="form-group">
                <label for="tools-used">Tools/Engine Used</label>
                <input type="text" id="tools-used" name="tools-used" placeholder="e.g., Godot, Unity, Aseprite" />
              </div>

              <div class="form-group">
                <label for="email">Contact Email *</label>
                <input type="email" id="email" name="email" required placeholder="your@email.com" />
              </div>

              <div class="form-group checkbox-group">
                <label>
                  <input type="checkbox" name="open-source" value="yes" />
                  My game uses open source assets/code (following jam rules)
                </label>
              </div>

              <div class="form-group checkbox-group">
                <label>
                  <input type="checkbox" name="confirm-rules" required />
                  I confirm my game follows all jam rules *
                </label>
              </div>

              <button type="submit" class="submit-button" id="submit-btn" disabled>
                <span>Submit Game</span>
                <span class="arrow">‚Üó</span>
              </button>
            </form>
          </div>
        </div>

        <!-- After submission closes -->
        <div id="closed-message" class="closed-message" style="display: none;">
          <div class="closed-icon">üèÅ</div>
          <h2>Submissions Closed</h2>
          <p>The game jam has ended! Thanks to everyone who participated.</p>
          <p>Check out all the amazing submissions:</p>
          <a href="#" class="view-games-btn">View All Games ‚Üí</a>
        </div>
      </div>
    </section>

    <!-- Tips Section -->
    <section class="section section-alt" id="tips">
      <div class="container">
        <h2>Submission Tips</h2>
        <div class="tips-grid">
          <div class="tip-card">
            <span class="tip-icon"><Icon name="gift" size={32} /></span>
            <h3>Host Your Game</h3>
            <p>Upload to itch.io (free), GitHub releases, or any hosting service. Make sure it's publicly accessible.</p>
          </div>
          <div class="tip-card">
            <span class="tip-icon"><Icon name="edit" size={32} /></span>
            <h3>Include Instructions</h3>
            <p>Add a README or description with controls, how to play, and any known issues.</p>
          </div>
          <div class="tip-card">
            <span class="tip-icon"><Icon name="camera" size={32} /></span>
            <h3>Add Screenshots</h3>
            <p>Include at least one screenshot or GIF in your README showing your game in action.</p>
          </div>
          <div class="tip-card">
            <span class="tip-icon"><CrossIcon size={32} /></span>
            <h3>Explain the Faith</h3>
            <p>Briefly describe how your game incorporates Catholic themes - judges want to understand your vision!</p>
          </div>
        </div>
      </div>
    </section>
  </main>
</Layout>

<style>
  /* Base Styles */
  :root {
    --color-bg: #0f0f23;
    --color-text: #1a1a2e;
    --color-accent: #FFD700;
    --color-green: #4CAF50;
    --color-red: #f44336;
    --color-blue: #2196F3;
    --color-purple: #9C27B0;
  }

  .submissions-page {
    min-height: 100vh;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  }

  .container {
    max-width: 800px;
    margin: 0 auto;
    padding: 0 1.5rem;
  }

  /* Hero */
  .submissions-hero {
    padding: 2rem 0 1.5rem;
    text-align: center;
  }

  .back-link {
    display: inline-block;
    color: rgba(255,255,255,0.8);
    text-decoration: none;
    font-family: 'Press Start 2P', monospace;
    font-size: 0.7rem;
    margin-bottom: 1rem;
    transition: color 0.2s;
  }

  .back-link:hover {
    color: var(--color-accent);
  }

  h1 {
    font-family: 'Press Start 2P', monospace;
    font-size: clamp(1.5rem, 4vw, 2.5rem);
    color: white;
    text-shadow: 4px 4px 0 rgba(0,0,0,0.3);
    margin-bottom: 1rem;
  }

  .tagline {
    color: rgba(255,255,255,0.9);
    font-size: 1.1rem;
    max-width: 500px;
    margin: 0 auto;
  }

  /* Status Banner */
  .status-section {
    padding: 1rem 0;
  }

  .status-banner {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
    padding: 1rem 1.5rem;
    border-radius: 8px;
    font-family: 'Press Start 2P', monospace;
    font-size: 0.75rem;
    text-align: center;
  }

  .status-banner.pending {
    background: rgba(255,193,7,0.2);
    border: 3px solid #FFC107;
    color: #FFC107;
  }

  .status-banner.open {
    background: rgba(76,175,80,0.2);
    border: 3px solid var(--color-green);
    color: var(--color-green);
    animation: pulse-green 2s infinite;
  }

  .status-banner.closed {
    background: rgba(244,67,54,0.2);
    border: 3px solid var(--color-red);
    color: var(--color-red);
  }

  @keyframes pulse-green {
    0%, 100% { box-shadow: 0 0 0 0 rgba(76,175,80,0.4); }
    50% { box-shadow: 0 0 20px 5px rgba(76,175,80,0.2); }
  }

  .status-icon {
    font-size: 1.2rem;
  }

  /* Form Section */
  .section {
    padding: 2rem 0;
  }

  .section-alt {
    background: rgba(0,0,0,0.1);
  }

  .form-container {
    background: white;
    border: 4px solid var(--color-text);
    padding: 2rem;
    position: relative;
    overflow: hidden;
  }

  .form-container.locked .submission-form {
    filter: blur(3px);
    pointer-events: none;
    user-select: none;
  }

  .lock-overlay {
    position: absolute;
    inset: 0;
    background: rgba(26,26,46,0.95);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 10;
    text-align: center;
    padding: 2rem;
  }

  .form-container:not(.locked) .lock-overlay {
    display: none;
  }

  .lock-icon {
    font-size: 4rem;
    margin-bottom: 1rem;
  }

  .lock-overlay h2 {
    font-family: 'Press Start 2P', monospace;
    font-size: 1.2rem;
    color: var(--color-accent);
    margin-bottom: 1rem;
  }

  .lock-overlay p {
    color: rgba(255,255,255,0.8);
    margin-bottom: 1.5rem;
  }

  .countdown-mini {
    font-family: 'Press Start 2P', monospace;
    font-size: 0.9rem;
    color: var(--color-accent);
  }

  /* Form Styles */
  .submission-form h2 {
    font-family: 'Press Start 2P', monospace;
    font-size: 1rem;
    color: var(--color-text);
    margin-bottom: 1.5rem;
    text-align: center;
  }

  .form-group {
    margin-bottom: 1.25rem;
  }

  .form-group label {
    display: block;
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: var(--color-text);
  }

  .form-group input[type="text"],
  .form-group input[type="email"],
  .form-group input[type="url"],
  .form-group textarea {
    width: 100%;
    padding: 0.75rem;
    border: 3px solid var(--color-text);
    font-size: 1rem;
    font-family: inherit;
    transition: border-color 0.2s;
  }

  .form-group input:focus,
  .form-group textarea:focus {
    outline: none;
    border-color: var(--color-accent);
  }

  .checkbox-group label {
    display: flex;
    align-items: flex-start;
    gap: 0.5rem;
    cursor: pointer;
  }

  .checkbox-group input[type="checkbox"] {
    width: 20px;
    height: 20px;
    margin-top: 2px;
  }

  .field-hint {
    display: block;
    font-size: 0.8rem;
    color: #666;
    margin-top: 0.25rem;
  }

  .field-error {
    display: none;
    font-size: 0.8rem;
    color: #f44336;
    margin-top: 0.25rem;
  }

  .field-error.show {
    display: block;
  }

  .form-group input:invalid:not(:placeholder-shown) {
    border-color: #f44336;
  }

  .form-group input:valid:not(:placeholder-shown) {
    border-color: #4CAF50;
  }

  .submit-button {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    width: 100%;
    padding: 1rem;
    background: linear-gradient(135deg, var(--color-green), #45a049);
    color: white;
    border: 4px solid var(--color-text);
    font-family: 'Press Start 2P', monospace;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.2s;
    box-shadow: 4px 4px 0 var(--color-text);
  }

  .submit-button:hover:not(:disabled) {
    transform: translate(-2px, -2px);
    box-shadow: 6px 6px 0 var(--color-text);
  }

  .submit-button:active:not(:disabled) {
    transform: translate(2px, 2px);
    box-shadow: 2px 2px 0 var(--color-text);
  }

  .submit-button:disabled {
    background: #ccc;
    cursor: not-allowed;
    opacity: 0.7;
  }

  .submit-button .arrow {
    font-size: 1.2rem;
  }

  /* Closed Message */
  .closed-message {
    background: white;
    border: 4px solid var(--color-text);
    padding: 3rem 2rem;
    text-align: center;
  }

  .closed-icon {
    font-size: 4rem;
    margin-bottom: 1rem;
  }

  .closed-message h2 {
    font-family: 'Press Start 2P', monospace;
    font-size: 1.2rem;
    color: var(--color-text);
    margin-bottom: 1rem;
  }

  .closed-message p {
    color: #666;
    margin-bottom: 0.5rem;
  }

  .view-games-btn {
    display: inline-block;
    margin-top: 1.5rem;
    padding: 1rem 2rem;
    background: var(--color-accent);
    color: var(--color-text);
    text-decoration: none;
    font-family: 'Press Start 2P', monospace;
    font-size: 0.8rem;
    border: 3px solid var(--color-text);
    transition: all 0.2s;
  }

  .view-games-btn:hover {
    transform: translate(-2px, -2px);
    box-shadow: 4px 4px 0 var(--color-text);
  }

  /* Tips Grid */
  .tips-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1.5rem;
  }

  @media (max-width: 600px) {
    .tips-grid {
      grid-template-columns: 1fr;
    }
  }

  .tip-card {
    background: white;
    border: 3px solid var(--color-text);
    padding: 1.5rem;
    text-align: center;
  }

  .tip-icon {
    font-size: 2.5rem;
    display: block;
    margin-bottom: 0.75rem;
  }

  .tip-card h3 {
    font-family: 'Press Start 2P', monospace;
    font-size: 0.7rem;
    color: var(--color-text);
    margin-bottom: 0.75rem;
  }

  .tip-card p {
    font-size: 0.9rem;
    color: #666;
    line-height: 1.5;
  }

  #tips h2 {
    font-family: 'Press Start 2P', monospace;
    font-size: 1.2rem;
    color: white;
    text-align: center;
    margin-bottom: 2rem;
  }
</style>

<script define:vars={{ jamStart, jamEnd }}>
  const startTime = new Date(jamStart).getTime();
  const endTime = new Date(jamEnd).getTime();
  const urlParams = new URLSearchParams(window.location.search);
  const forceUnlock = urlParams.get('unlock') === 'true';

  function updateStatus() {
    const now = Date.now();
    const banner = document.getElementById('status-banner');
    const formContainer = document.getElementById('submission-form-container');
    const closedMessage = document.getElementById('closed-message');
    const submitBtn = document.getElementById('submit-btn');
    const countdownMini = document.getElementById('countdown-mini');

    if (forceUnlock || (now >= startTime && now <= endTime)) {
      // During jam OR testing mode - submissions open!
      banner.className = 'status-banner open';
      banner.innerHTML = '<span class="status-icon">üéÆ</span><span class="status-text">SUBMISSIONS ARE OPEN!</span>';
      formContainer.classList.remove('locked');
      formContainer.style.display = 'block';
      closedMessage.style.display = 'none';
      submitBtn.disabled = false;

    } else if (now < startTime) {
      // Before jam starts
      banner.className = 'status-banner pending';
      banner.innerHTML = '<span class="status-icon">‚è≥</span><span class="status-text">Submissions open when jam starts</span>';
      formContainer.classList.add('locked');
      formContainer.style.display = 'block';
      closedMessage.style.display = 'none';
      submitBtn.disabled = true;

      // Update mini countdown
      const diff = startTime - now;
      const hours = Math.floor(diff / (1000 * 60 * 60));
      const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((diff % (1000 * 60)) / 1000);
      countdownMini.textContent = `Opens in ${hours}h ${minutes}m ${seconds}s`;

    } else {
      // After jam ends
      banner.className = 'status-banner closed';
      banner.innerHTML = '<span class="status-icon">üèÅ</span><span class="status-text">Submissions closed</span>';
      formContainer.style.display = 'none';
      closedMessage.style.display = 'block';
    }
  }

  // Run immediately and update every second
  updateStatus();
  setInterval(updateStatus, 1000);

  // GitHub URL validation with helpful messages
  const githubInput = document.getElementById('github-repo');
  const githubError = document.getElementById('github-error');

  function validateGitHub() {
    let value = githubInput.value.trim();
    if (!value) {
      githubError.textContent = '';
      githubError.classList.remove('show');
      return;
    }

    // Auto-add https:// if missing
    if (value && !value.startsWith('http')) {
      if (value.startsWith('github.com')) {
        value = 'https://' + value;
        githubInput.value = value;
      } else if (value.includes('github.com')) {
        value = 'https://' + value.substring(value.indexOf('github.com'));
        githubInput.value = value;
      }
    }

    let errorMsg = '';

    if (!value.startsWith('http')) {
      errorMsg = 'URL must start with https://';
    } else if (!value.includes('github.com')) {
      errorMsg = 'Must be a GitHub URL (github.com)';
    } else if (!value.match(/github\.com\/[^\/]+\/[^\/]+/)) {
      errorMsg = 'Include username and repo: github.com/username/repo';
    } else if (value.includes(' ')) {
      errorMsg = 'URL cannot contain spaces';
    }

    if (errorMsg) {
      githubError.textContent = errorMsg;
      githubError.classList.add('show');
    } else {
      githubError.textContent = '';
      githubError.classList.remove('show');
    }
  }

  githubInput.addEventListener('input', validateGitHub);
  githubInput.addEventListener('blur', validateGitHub);
</script>
